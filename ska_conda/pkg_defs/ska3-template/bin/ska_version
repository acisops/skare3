#!${PREFIX}/bin/python
"""
Create and return an environment version string based on the ska3-* conda
packages in an environment.

Example:

core-2018.07.16:flight-2018.07.16:pinned-2018.07.16:template-0.1

"""

import subprocess
import json
# Conda list output appears already sorted by package name
pkgs_json = subprocess.check_output(["conda", "list", "--json"])
pkgs = json.loads(pkgs_json)
ska3_pkgs = [f"{pkg['name'].lstrip('ska3-')}-{pkg['version']}"
             for pkg in pkgs if pkg['name'].startswith('ska3-')]
print(":".join(ska3_pkgs))
